<!DOCTYPE html>
<html>
  <head>
  <title>تغيير كلمة السر</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script> 
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">   
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <meta name="viewport" content="width = device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script>
    $(document).ready(function(){
    var passOne = $("#passOne").val();
    var passTwo = $("#passTwo").val();
    $("#footerText").html("غير متطابقات ");
    var checkAndChange = function()
    {
      if(passOne.length < 1){
        if($("#footer").hasClass("correct")){
          $("#footer").removeClass("correct").addClass("incorrect");
          $("#footerText").html("غير متطابقات ");
        }else{
          $("#footerText").html("غير متطابقات ");
        }
      }
      else if($("#footer").hasClass("incorrect"))
      {
        if(passOne == passTwo){
          $("#footer").removeClass("incorrect").addClass("correct");
          $("#footerText").html("التالي");
          
          $("#footerText").val("التالي");
          
          
        }
      }
      else
      {
        if(passOne != passTwo){
          $("#footer").removeClass("correct").addClass("incorrect");
          $("#footerText").html("غير متطابقات ");
        } 
      }   
    }
    
    
    
    $("input").keyup(function(){
      var newPassOne = $("#passOne").val();
      var newPassTwo = $("#passTwo").val();
      
      passOne = newPassOne;
      passTwo = newPassTwo;
      
      checkAndChange();
    });
  });
    </script>
     
</head>
<body>
  <section class="headerinfo">
    <nav>
        <!-- <a href="index.html"><img src="images/Logo.jpg"></a> -->
        <div class="nav-links3" id="navLinks">
            <ul>
              <li>
                <form  action="{{ url_for('afterlogin') }}" method="POST">
                  <input style="display: none" type="text" name="number" value="{{v}}" id="number" >
                  <button type="submit" class="gh">رجوع</button><i class="jk fa fa-backward"></i>
                  </form></li>

                <li><a href="{{ url_for('login') }}">تسجيل الخروج</a><i class="jk fa fa-sign-out" ></i></li>
               
                <li><a href="{{ url_for('home') }}">الصفحة الرئيسية</a><i class="jk fa fa-home" ></i></li>
            </ul>
        </div>

        
    </nav>
    <center>
        <div class="sidebar1">
            <br><br>
   
  <h1 class="h1">تغيير كلمة السر</h1>
  <input style="display: none" type="text" name="confirm" value="" id="confirm" >
  <input style="display: none" type="text" name="std_id" value="{{v}}" id="std_id" >
  <br
  <center>
  <div class="editInfo">
<table class="changetable">
<img class="ph" src="{{ url_for('static', filename='secure.jpeg') }}">

        <div id="fm1">
            <input  id="base"class="iinn" type="password" placeholder="كلمة السر الحالية" required />
            <!-- لازم يقارنها مع الاصليه الي بالداتا بيس  -->
            <br><br>
            <input  class="iinn" type="password" id="passOne" name="psw" placeholder="كلمة السر الجديدة"
            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
             title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" required>
            <br><br>
            <input class="iinn" type="password" placeholder="تأكيد كلمة السر" id="passTwo"/>
          </div>
          <div id="footer" class="incorrect">
            <center><h1 id="footerText">Filler text</h1></center>
          </div></form>
        </div>
  
  
  
  <!-- <div id="msg">
    <h3>:يجب أن تحتوي كلمة السر على</h3>
    <p id="letter" class="invalid">حرف صغير</p>
    <p id="capital" class="invalid">حرف كبير</p>
    <p id="number" class="invalid">رقم</p>
    <p id="length" class="invalid">لا يقل عن 8 حدود</p>
  </div> -->
                  
  <script>
  var myInput = document.getElementById("passOne");
  var letter = document.getElementById("letter");
  var capital = document.getElementById("capital");
  var number = document.getElementById("number");
  var length = document.getElementById("length");
  
  // When the user clicks on the password field, show the message box
  myInput.onfocus = function() {
    document.getElementById("msg").style.display = "block";
  }
  
  // When the user clicks outside of the password field, hide the message box
  myInput.onblur = function() {
    document.getElementById("msg").style.display = "none";
  }
  
  // When the user starts to type something inside the password field
  myInput.onkeyup = function() {
    // Validate lowercase letters
    var lowerCaseLetters = /[a-z]/g;
    if(myInput.value.match(lowerCaseLetters)) {  
      letter.classList.remove("invalid");
      letter.classList.add("valid");
    } else {
      letter.classList.remove("valid");
      letter.classList.add("invalid");
    }
    
    // Validate capital letters
    var upperCaseLetters = /[A-Z]/g;
    if(myInput.value.match(upperCaseLetters)) {  
      capital.classList.remove("invalid");
      capital.classList.add("valid");
    } else {
      capital.classList.remove("valid");
      capital.classList.add("invalid");
    }
  
    // Validate numbers
    var numbers = /[0-9]/g;
    if(myInput.value.match(numbers)) {  
      number.classList.remove("invalid");
      number.classList.add("valid");
    } else {
      number.classList.remove("valid");
      number.classList.add("invalid");
    }
    
    // Validate length
    if(myInput.value.length >= 8) {
      length.classList.remove("invalid");
      length.classList.add("valid");
    } else {
      length.classList.remove("valid");
      length.classList.add("invalid");
    }
  }

  $("#footerText").click(function(){

    if ($("#footerText").val()=='التالي'){
         var std_id=document.getElementById("std_id").value;
         var base=document.getElementById("base").value;
         var passOne=document.getElementById("passOne").value;
         var passTwo=document.getElementById("passTwo").value;
       console.log("yas")
    
    $.ajax({
    url: "{{ url_for('chgpass_ajax') }}",
    data: {'std_id' : std_id , 'base' :base , 'passOne':passOne,'passTwo':passTwo },
    type: 'POST',
   success: function(response) {
         console.log(response)

    if(response=="yes"){
        document.getElementById('confirm').value="نم تغيير كلمة السر";
       document.getElementById('confirm').style="block";
    }
    else{
       document.getElementById('confirm').value="هناك خطأ";
       document.getElementById('confirm').style="block";
    }
       

   },
  error: function(error) {
   console.log(error) 
   }
   });  
}
else{
    document.getElementById('confirm').value="هناك خطأ";
       document.getElementById('confirm').style="block";
}                     
         
 });


 if(annyang) {
          var commands = {
           'تسجيل الخروج':function(){     
             document.getElementsByTagName("a")[1].click();
             
           },
           'الصفحه الرئيسيه':function(){     
             document.getElementsByTagName("a")[2].click();
             
           },
           'رجوع':function(){     
            document.getElementsByClassName("gh")[0].click();        
           }, 
           'كلمه السر الحاليه *tag':function(variable){ 
            document.getElementById("msg").style.display = "none";
            cc=variable.replaceAll(" ", "");
            cc1=convert(cc);
            console.log(cc1);
            document.getElementsByClassName("iinn")[0].value=cc1; 
            
           },
           'كلمه السر الجديده *tag':function(variable){ 
            cc=variable.replaceAll(" ", "");
            cc1=convert(cc);
            console.log(cc1);
            document.getElementsByClassName("iinn")[1].value=cc1;
            vv();
            gg(); 
           },
           'تاكيد كلمه السر *tag':function(variable){     
            document.getElementById("msg").style.display = "none";
            cc=variable.replaceAll(" ", "");
            cc1=convert(cc);
            console.log(cc1);
            document.getElementsByClassName("iinn")[2].value=cc1;
            gg();    
           },
           'التالي':function(){     
            $("#footerText").click();          
           },
          
        
          }
         };
         annyang.setLanguage('ar-PA');
         // Add our commands to annyang
         annyang.addCommands(commands);
       
         annyang.debug();
        annyang.start({ autoRestart: true, continuous: true });

function vv(){
  var myInput = document.getElementById("passOne");
  var letter = document.getElementById("letter");
  var capital = document.getElementById("capital");
  var number = document.getElementById("number");
  var length = document.getElementById("length");
  
  var lowerCaseLetters = /[a-z]/g;
    if(myInput.value.match(lowerCaseLetters)) {  
      letter.classList.remove("invalid");
      letter.classList.add("valid");
    } else {
      letter.classList.remove("valid");
      letter.classList.add("invalid");
    }
    
    // Validate capital letters
    var upperCaseLetters = /[A-Z]/g;
    if(myInput.value.match(upperCaseLetters)) {  
      capital.classList.remove("invalid");
      capital.classList.add("valid");
    } else {
      capital.classList.remove("valid");
      capital.classList.add("invalid");
    }
  
    // Validate numbers
    var numbers = /[0-9]/g;
    if(myInput.value.match(numbers)) {  
      number.classList.remove("invalid");
      number.classList.add("valid");
    } else {
      number.classList.remove("valid");
      number.classList.add("invalid");
    }
    
    // Validate length
    if(myInput.value.length >= 8) {
      length.classList.remove("invalid");
      length.classList.add("valid");
    } else {
      length.classList.remove("valid");
      length.classList.add("invalid");
    }
    document.getElementById("msg").style.display = "block";
}

//////////////////        

function gg(){
  var passOne = $("#passOne").val();
  var passTwo = $("#passTwo").val();
  console.log(passOne)
  console.log(passTwo)
     if(passOne.length < 1){
        console.log("yes")
        if($("#footer").hasClass("correct")){
          $("#footer").removeClass("correct").addClass("incorrect");
          $("#footerText").html("غير متطابقات ");
        }else{
          $("#footerText").html("غير متطابقات ");
        }
      }
      else if($("#footer").hasClass("incorrect"))
      {
        console.log("no")
        if(passOne == passTwo){
          $("#footer").removeClass("incorrect").addClass("correct");
          $("#footerText").html("التالي");
          
          $("#footerText").val("التالي");
          
          
        }
      }
      else
      {
        if(passOne != passTwo){
          $("#footer").removeClass("correct").addClass("incorrect");
          $("#footerText").html("غير متطابقات ");
        } 
      }   
    }
    


function convert(variable){

        if(variable.includes("تعجب")){
          
          variable=variable.replaceAll("تعجب","!")
         }
       
        if(variable.includes("سلم")){
          variable=variable.replaceAll("سلم","#")
          
        }
        if(variable.includes("دولارساين")){
          variable=variable.replaceAll("دولارساين", "$")
        }        
        if(variable.includes("ستار")){
          variable=variable.replaceAll("ستار", "*") 
        }
        if(variable.includes("اندرسكور")){
          variable=variable.replaceAll("اندرسكور", "_")
          
        }
        if(variable.includes("سلاش")){
          variable=variable.replaceAll("سلاش","-")
        }
        if(variable.includes("هوتميل")){
          variable=variable.replaceAll("هوتميل","hotmail")        
         }
         if(variable.includes("جيميل")){
           variable=variable.replaceAll("جيميل","gmail")
         }
        if(variable.includes("كابيتالاتش")){
          variable=variable.replaceAll("كابيتالاتش","H")
        }
        if(variable.includes("اتش")){
          variable=variable.replaceAll("اتش","h")
        }
        if(variable.includes("ات")){
          variable=variable.replaceAll("ات","@")
        } 
       if(variable.includes("دوت")){
           variable=variable.replaceAll("دوت",".")
         }
         if(variable.includes("كوم")){
           variable=variable.replaceAll("كوم","com")
         }
         if(variable.includes("كابيتالكيو")){
           variable=variable.replaceAll("كابيتالكيو","Q")
         }
         if(variable.includes("كابيتالدبليو")){
          variable=variable.replaceAll("كابيتالدبليو","W")
        }
        if(variable.includes("كابيتالايه")){
          variable=variable.replaceAll("كابيتالايه","A") 
        }
        if(variable.includes("كابيتالار")){
          variable=variable.replaceAll("كابيتالار", "R")
        }
        if(variable.includes("كابيتالتي")){
          variable=variable.replaceAll("كابيتالتي", "T") 
        }
        if(variable.includes("كابيتالواي")){
          variable=variable.replaceAll("كابيتالواي", "y")
        }
        if(variable.includes("كابيتاليو")){
          variable=variable.replaceAll("كابيتاليو","U")
        }
        if(variable.includes("كابيتالاي")){
          variable=variable.replaceAll("كابيتالاي","I")
        }
        if(variable.includes("كابيتالاو")){
          variable=variable.replaceAll("كابيتالاو","O")
        }
        if(variable.includes("كابيتالهي","كابيتالبهيه","كابيتالبهي")){
          variable=variable.replaceAll("كابيتالبهيه","P")
          variable=variable.replaceAll("كابيتالبهي","P")
          variable=variable.replaceAll("كابيتالهي","P")
        }
        if(variable.includes("كابيتالاي")){
          variable=variable.replaceAll("كابيتالاي","E")
        }
        if(variable.includes("كابيتالاس")){
          variable=variable.replaceAll("كابيتالاس","S")
        }
        if(variable.includes("كابيتالدي")){
          variable=variable.replaceAll("كابيتالدي","D")
        } 
        if(variable.includes("كابيتالاف")){
          variable=variable.replaceAll("كابيتالاف","F")
        }
        if(variable.includes("كابيتالجي")){
          variable=variable.replaceAll("كابيتالجي","G")
        }
       
        if(variable.includes("كابيتالجاي")){
          variable=variable.replaceAll("كابيتالجاي","J")
        }
        if(variable.includes("كابيتالكي","كابيتالكيك")){
          variable=variable.replaceAll("كابيتالكيك","K")
          variable=variable.replaceAll("كابيتالكي","K")
        }
        if(variable.includes("كابيتالال")){
          variable=variable.replaceAll("كابيتالال","L")
        }
        if(variable.includes("كابيتالام")){
          variable=variable.replaceAll("كابيتالام","M")
        }
        if(variable.includes("كابيتالان")){
          variable=variable.replaceAll("كابيتالان","N")
        }
        if(variable.includes("كابيتالبي")){
          variable=variable.replaceAll("كابيتالبي","B")
        } 
        if(variable.includes("كابيتالفي")){
          variable=variable.replaceAll("كابيتالفي","V")
        }
        if(variable.includes("كابيتالسي")){ 
          variable=variable.replaceAll("كابيتالسي","C")
        }
        if(variable.includes("كابيتالاكس")){
          variable=variable.replaceAll("كابيتالاكس","X")
        }
        if(variable.includes("كابيتالزد")){
          variable=variable.replaceAll("كابيتالزد","Z")
        }
        
        if(variable.includes("كيو")){
           variable=variable.replaceAll("كيو","q")
         }
        if(variable.includes("دبليو")){
          variable=variable.replaceAll("دبليو","w")
        }
        if(variable.includes("ايه")){
          variable=variable.replaceAll("ايه","a") 
        }
        if(variable.includes("ار")){
          variable=variable.replaceAll("ار", "r")
        }
        if(variable.includes("تي")){
          variable=variable.replaceAll("تي", "t") 
        }
        if(variable.includes("واي")){
          variable=variable.replaceAll("واي", "y")
        }
        if(variable.includes("يو")){
          variable=variable.replaceAll("يو","u")
        }
        
        if(variable.includes("او")){
          variable=variable.replaceAll("او","o")
        }
        if(variable.includes("هي","هيه","بهيه")){
          variable=variable.replaceAll("بهيه","p")
          variable=variable.replaceAll("هيه","p")
          variable=variable.replaceAll("هي","p")
        }
       
        if(variable.includes("اس")){
          variable=variable.replaceAll("اس","s")
        }
        if(variable.includes("دي")){
          variable=variable.replaceAll("دي","d")
        }
        if(variable.includes("اف")){
          variable=variable.replaceAll("اف","f")
        }
        if(variable.includes("جي")){
          variable=variable.replaceAll("جي","g")
        }
        if(variable.includes("جاي")){
          variable=variable.replaceAll("جاي","j")
        }
        if(variable.includes("اي")){
          variable=variable.replaceAll("اي","e")
        }
        if(variable.includes("اي")){
          variable=variable.replaceAll("اي","i")
        }
        if(variable.includes("كي","كيك")){
          variable=variable.replaceAll("كيك","k")
          variable=variable.replaceAll("كي","k")
        }
        if(variable.includes("ال")){
          variable=variable.replaceAll("ال","l")
        }
        if(variable.includes("ام")){
          variable=variable.replaceAll("ام","m")
        }
        if(variable.includes("ان")){
          variable=variable.replaceAll("ان","n")
        }
        if(variable.includes("بي")){
          variable=variable.replaceAll("بي","b")
        }
        if(variable.includes("في")){
          variable=variable.replaceAll("في","v")
        }
        if(variable.includes("سي")){
          variable=variable.replaceAll("سي","c")
        }
        if(variable.includes("اكس")){
          variable=variable.replaceAll("اكس","x")
        }
        if(variable.includes("زد")){
          variable=variable.replaceAll("زد","z")
        }
       return variable
      
}

  </script>
  
  </body>
  </html>
  